# Routine ä»»åŠ¡é¡µé¢é‡æ„è¯´æ˜

## ğŸ¯ é‡æ„ç›®æ ‡

å°† Routine ä»»åŠ¡çš„å±•ç¤ºé€»è¾‘ä¼˜åŒ–ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„é¡µé¢ï¼š

1. **è“è‰²é¡µé¢ï¼ˆHomeViewï¼‰** - ä»»åŠ¡ç®¡ç†é¡µé¢
2. **ç»¿è‰²é¡µé¢ï¼ˆStatsViewï¼‰** - ç»Ÿè®¡å’Œå¯è§†åŒ–é¡µé¢

---

## ğŸ“± é¡µé¢è®¾è®¡

### 1. è“è‰²é¡µé¢ï¼ˆHomeViewï¼‰- ä»»åŠ¡ç®¡ç†

**ç”¨é€”**ï¼šæ—¥å¸¸ä»»åŠ¡ç®¡ç†ï¼Œå¿«é€ŸæŸ¥çœ‹å’Œå®Œæˆä»Šå¤©çš„ä»»åŠ¡

**æ˜¾ç¤ºå†…å®¹**ï¼š
- To-do ä»»åŠ¡ï¼ˆä¸€æ¬¡æ€§ä»»åŠ¡ï¼‰
- Routine ä»»åŠ¡ï¼ˆé‡å¤ä»»åŠ¡ï¼‰
- åªæ˜¾ç¤ºä»Šå¤©æœ‰æ²¡æœ‰å®Œæˆï¼ˆç®€å•å‹¾é€‰æ¡†ï¼‰
- ä¸æ˜¾ç¤ºå†å²çƒ­åŠ›å›¾

**äº¤äº’**ï¼š
- å‹¾é€‰/å–æ¶ˆå‹¾é€‰ä»»åŠ¡
- åˆ›å»ºæ–°ä»»åŠ¡
- åˆ é™¤ä»»åŠ¡
- æ»‘åŠ¨åˆ é™¤

**ç‰¹ç‚¹**ï¼š
- ç®€æ´æ˜äº†ï¼Œä¸“æ³¨äºå½“å¤©ä»»åŠ¡
- To-do å’Œ Routine ä»»åŠ¡æ ·å¼ä¸€è‡´
- å¿«é€Ÿæ“ä½œï¼Œä¸éœ€è¦å±•å¼€æŸ¥çœ‹å†å²

---

### 2. ç»¿è‰²é¡µé¢ï¼ˆStatsViewï¼‰- ç»Ÿè®¡é¡µé¢

**ç”¨é€”**ï¼šæŸ¥çœ‹ Routine ä»»åŠ¡çš„å®Œæˆå†å²å’Œç»Ÿè®¡æ•°æ®

**æ˜¾ç¤ºå†…å®¹**ï¼š
- åªæ˜¾ç¤º Routine ä»»åŠ¡
- å®Œæ•´çš„æ‰“å¡å†å²çƒ­åŠ›å›¾ï¼ˆç±»ä¼¼ GitHub è´¡çŒ®å›¾ï¼‰
- æœ€é•¿è¿ç»­æ‰“å¡å¤©æ•°å¾½ç« 
- ä¸¤ä¸ª Tabï¼š
  - **Routine**ï¼šæ˜¾ç¤ºæ‰€æœ‰ Routine ä»»åŠ¡å’Œæ‰“å¡å†å²
  - **Done**ï¼šæ˜¾ç¤ºå·²å®Œæˆä»»åŠ¡çš„å†å²è®°å½•

**äº¤äº’**ï¼š
- å‹¾é€‰ä»Šå¤©çš„ä»»åŠ¡ï¼ˆå®æ—¶åŒæ­¥åˆ°æ•°æ®åº“ï¼‰
- ç‚¹å‡»ä»»åŠ¡å¡ç‰‡æŸ¥çœ‹è¯¦ç»†çƒ­åŠ›å›¾
- åœ¨å¼¹çª—ä¸­æŸ¥çœ‹å®Œæ•´çš„å¹´åº¦æ‰“å¡æ—¥å†

**ç‰¹ç‚¹**ï¼š
- å¯è§†åŒ–å¼ºï¼Œæ•°æ®ä¸°å¯Œ
- æ¿€åŠ±ç”¨æˆ·åšæŒä¹ æƒ¯
- ä»çœŸå®åç«¯æ•°æ®åŠ è½½

---

## ğŸ”„ é‡æ„å†…å®¹

### ä¿®æ”¹çš„æ–‡ä»¶

#### 1. **HomeView.tsx** âœ…
- ç§»é™¤ `routineCompletions` å’Œ `onRoutineCompletionChange` å±æ€§
- æ‰€æœ‰ä»»åŠ¡ï¼ˆTo-do å’Œ Routineï¼‰éƒ½ä½¿ç”¨ç®€å•çš„ TaskItem æ˜¾ç¤º
- ä¸æ˜¾ç¤ºçƒ­åŠ›å›¾

#### 2. **TaskGroup.tsx** âœ…
- ç§»é™¤ Routine ä»»åŠ¡çš„ç‰¹æ®Šå¤„ç†
- æ‰€æœ‰ä»»åŠ¡ç±»å‹éƒ½ä½¿ç”¨ TaskItem ç»„ä»¶
- ç§»é™¤ `routineCompletions` å’Œ `onRoutineCompletionChange` å±æ€§

#### 3. **AppTabsPage.tsx** âœ…
- ç§»é™¤ `routineCompletions` çŠ¶æ€ç®¡ç†
- ç§»é™¤ `getAllRoutineCompletions` è°ƒç”¨
- ç§»é™¤ `handleRoutineCompletionChange` å›è°ƒå‡½æ•°
- ç®€åŒ–ä»»åŠ¡åŠ è½½é€»è¾‘

#### 4. **StatsView.tsx** âœ…
- æ¥å…¥çœŸå®åç«¯æ•°æ®
- ä» Supabase åŠ è½½æ‰€æœ‰ Routine ä»»åŠ¡
- ä» `routine_completions` è¡¨åŠ è½½å®Œæˆå†å²
- è®¡ç®—æœ€é•¿è¿ç»­æ‰“å¡å¤©æ•°
- å®æ—¶æ›´æ–°æ•°æ®åº“å’Œæœ¬åœ°çŠ¶æ€

#### 5. **RoutineTaskItem.tsx** âŒ
- å·²åˆ é™¤ï¼Œä¸å†éœ€è¦

---

## ğŸ“Š æ•°æ®æµ

### HomeViewï¼ˆè“è‰²é¡µé¢ï¼‰

```
ç”¨æˆ·å‹¾é€‰ä»»åŠ¡
  â†“
AppTabsPage.toggleComplete()
  â†“
toggleReminderCompletion() â†’ æ›´æ–° tasks.completed_reminder
  â†“
å¦‚æœæ˜¯ Routine ä»»åŠ¡ï¼š
  toggleRoutineCompletion() â†’ æ›´æ–° routine_completions è¡¨
  â†“
æ›´æ–°æœ¬åœ° tasks çŠ¶æ€
  â†“
UI åˆ·æ–°ï¼ˆå‹¾é€‰æ¡†çŠ¶æ€æ”¹å˜ï¼‰
```

### StatsViewï¼ˆç»¿è‰²é¡µé¢ï¼‰

```
é¡µé¢åŠ è½½
  â†“
fetchRecurringReminders() â†’ åŠ è½½æ‰€æœ‰ Routine ä»»åŠ¡
  â†“
getAllRoutineCompletions() â†’ åŠ è½½å®Œæˆå†å²
  â†“
è½¬æ¢ä¸º Habit æ ¼å¼
  â†“
è®¡ç®—æœ€é•¿è¿ç»­å¤©æ•°
  â†“
æ¸²æŸ“çƒ­åŠ›å›¾
  
ç”¨æˆ·å‹¾é€‰ä»Šå¤©çš„ä»»åŠ¡
  â†“
toggleRoutineCompletion() â†’ æ›´æ–°æ•°æ®åº“
  â†“
æ›´æ–°æœ¬åœ° habits çŠ¶æ€
  â†“
é‡æ–°è®¡ç®—è¿ç»­å¤©æ•°
  â†“
UI åˆ·æ–°ï¼ˆçƒ­åŠ›å›¾å’Œå¾½ç« æ›´æ–°ï¼‰
```

---

## ğŸ¨ è§†è§‰è®¾è®¡

### HomeViewï¼ˆè“è‰²é¡µé¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Remind me to                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Enter your task here...    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  Morning â˜€ï¸                         â”‚
â”‚  â˜‘ Wake up in time    7:00 am â˜€ï¸   â”‚
â”‚  â˜ Read a book        8:30 am â˜€ï¸   â”‚
â”‚                                     â”‚
â”‚  Evening ğŸŒ™                          â”‚
â”‚  â˜‘ Go to sleep        10:00 pm ğŸŒ™  â”‚
â”‚  â˜ Take a shower      9:30 pm ğŸŒ™   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StatsViewï¼ˆç»¿è‰²é¡µé¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Good Job for                 â•­â”€â”€â”€â•® â”‚
â”‚                               â”‚ 25â”‚ â”‚
â”‚                               â”‚Daysâ”‚ â”‚
â”‚                               â•°â”€â”€â”€â•¯ â”‚
â”‚  [Routine]  [Done]                  â”‚
â”‚                                     â”‚
â”‚  â˜‘ Wake up in time    9:30 am â˜€ï¸   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Jan Feb Mar Apr May Jun ... â”‚   â”‚
â”‚  â”‚ ğŸŸ¨ğŸŸ¨ğŸŸ¨â¬œâ¬œğŸŸ¨ğŸŸ¨ğŸŸ¨â¬œâ¬œğŸŸ¨ğŸŸ¨ğŸŸ¨â¬œ   â”‚   â”‚
â”‚  â”‚ ğŸŸ¨â¬œğŸŸ¨ğŸŸ¨ğŸŸ¨â¬œğŸŸ¨ğŸŸ¨ğŸŸ¨â¬œğŸŸ¨â¬œğŸŸ¨ğŸŸ¨   â”‚   â”‚
â”‚  â”‚ ...                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â˜ Go to sleep        9:30 pm ğŸŒ™   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Jan Feb Mar Apr May Jun ... â”‚   â”‚
â”‚  â”‚ ğŸŸ¦ğŸŸ¦â¬œâ¬œğŸŸ¦ğŸŸ¦ğŸŸ¦â¬œğŸŸ¦ğŸŸ¦â¬œğŸŸ¦ğŸŸ¦ğŸŸ¦   â”‚   â”‚
â”‚  â”‚ ...                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°

```typescript
const calculateLongestStreak = (history: { [key: string]: boolean }): number => {
    const today = new Date();
    let currentStreak = 0;
    let longestStreak = 0;
    let tempStreak = 0;

    // ä»ä»Šå¤©å¼€å§‹å¾€å‰æ•°
    for (let i = 0; i < 365; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const key = formatDateKey(date);

        if (history[key]) {
            tempStreak++;
            if (i === 0 || currentStreak > 0) {
                currentStreak = tempStreak;
            }
        } else {
            if (tempStreak > longestStreak) {
                longestStreak = tempStreak;
            }
            tempStreak = 0;
        }
    }

    return Math.max(currentStreak, longestStreak, tempStreak);
};
```

### ä»»åŠ¡åˆ°ä¹ æƒ¯çš„è½¬æ¢

```typescript
const taskToHabit = (task: Task, completions: Set<string>): Habit => {
    // å°† Set è½¬æ¢ä¸º history å¯¹è±¡
    const history: { [key: string]: boolean } = {};
    completions.forEach(date => {
        history[date] = true;
    });

    // æ ¹æ®æ—¶é—´åˆ†ç±»é€‰æ‹©ä¸»é¢˜é¢œè‰²
    let theme: HabitTheme = 'gold';
    if (task.category === 'morning') theme = 'gold';
    else if (task.category === 'afternoon') theme = 'blue';
    else if (task.category === 'evening') theme = 'pink';

    return {
        id: task.id,
        title: task.text,
        timeLabel: `${task.displayTime} ${icon}`,
        theme,
        history,
    };
};
```

---

## âœ… ä¼˜åŠ¿

### 1. **èŒè´£åˆ†ç¦»**
- HomeView ä¸“æ³¨äºä»»åŠ¡ç®¡ç†
- StatsView ä¸“æ³¨äºæ•°æ®å¯è§†åŒ–
- æ¯ä¸ªé¡µé¢æœ‰æ¸…æ™°çš„ç”¨é€”

### 2. **æ€§èƒ½ä¼˜åŒ–**
- HomeView ä¸åŠ è½½å®Œæˆå†å²ï¼ŒåŠ è½½é€Ÿåº¦æ›´å¿«
- StatsView åªåœ¨éœ€è¦æ—¶åŠ è½½ç»Ÿè®¡æ•°æ®

### 3. **ç”¨æˆ·ä½“éªŒ**
- HomeView ç®€æ´å¿«é€Ÿï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨
- StatsView æ•°æ®ä¸°å¯Œï¼Œæ¿€åŠ±ç”¨æˆ·åšæŒä¹ æƒ¯

### 4. **ä»£ç ç®€æ´**
- ç§»é™¤äº† RoutineTaskItem ç»„ä»¶
- TaskGroup é€»è¾‘æ›´ç®€å•
- å‡å°‘äº†ç»„ä»¶é—´çš„æ•°æ®ä¼ é€’

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### HomeViewï¼ˆè“è‰²é¡µé¢ï¼‰- æ—¥å¸¸ä½¿ç”¨

**é€‚ç”¨åœºæ™¯**ï¼š
- æ—©ä¸Šèµ·åºŠåï¼Œå‹¾é€‰å®Œæˆçš„ä»»åŠ¡
- åˆ›å»ºæ–°çš„ä»»åŠ¡
- å¿«é€ŸæŸ¥çœ‹ä»Šå¤©è¦åšçš„äº‹æƒ…

**ä¼˜åŠ¿**ï¼š
- å¿«é€ŸåŠ è½½ï¼Œä¸éœ€è¦ç­‰å¾…ç»Ÿè®¡æ•°æ®
- ç®€å•ç›´è§‚ï¼Œä¸“æ³¨äºå½“å¤©ä»»åŠ¡
- To-do å’Œ Routine ä»»åŠ¡ä¸€èµ·ç®¡ç†

---

### StatsViewï¼ˆç»¿è‰²é¡µé¢ï¼‰- å®šæœŸæŸ¥çœ‹

**é€‚ç”¨åœºæ™¯**ï¼š
- æŸ¥çœ‹ä¹ æƒ¯å…»æˆè¿›åº¦
- å›é¡¾è¿‡å»çš„å®Œæˆæƒ…å†µ
- æ¿€åŠ±è‡ªå·±ç»§ç»­åšæŒ

**ä¼˜åŠ¿**ï¼š
- å¯è§†åŒ–å¼ºï¼Œä¸€ç›®äº†ç„¶
- æ˜¾ç¤ºè¿ç»­æ‰“å¡å¤©æ•°ï¼Œå¢åŠ æˆå°±æ„Ÿ
- ç‚¹å‡»å¯æŸ¥çœ‹è¯¦ç»†å†å²

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

- **HomeView**: `src/components/app-tabs/HomeView.tsx`
- **StatsView**: `src/components/app-tabs/StatsView.tsx`
- **TaskGroup**: `src/components/app-tabs/TaskGroup.tsx`
- **TaskItem**: `src/components/app-tabs/TaskItem.tsx`
- **AppTabsPage**: `src/pages/AppTabsPage.tsx`

### æœåŠ¡å±‚

- **reminderService**: `src/remindMe/services/reminderService.ts`
- **routineCompletionService**: `src/remindMe/services/routineCompletionService.ts`

### æ•°æ®åº“

- **tasks è¡¨**: å­˜å‚¨ä»»åŠ¡ä¿¡æ¯
- **routine_completions è¡¨**: å­˜å‚¨ Routine ä»»åŠ¡çš„æ¯æ—¥å®Œæˆè®°å½•

---

## ğŸ‰ æ€»ç»“

è¿™æ¬¡é‡æ„å®ç°äº†ï¼š

âœ… è“è‰²é¡µé¢ï¼ˆHomeViewï¼‰æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡ï¼Œæ ·å¼ç®€æ´ç»Ÿä¸€  
âœ… ç»¿è‰²é¡µé¢ï¼ˆStatsViewï¼‰æ˜¾ç¤º Routine ä»»åŠ¡çš„ç»Ÿè®¡å’Œçƒ­åŠ›å›¾  
âœ… æ¥å…¥çœŸå®åç«¯æ•°æ®ï¼Œä¸å†ä½¿ç”¨ç¡¬ç¼–ç çš„ä¾‹å­  
âœ… è®¡ç®—å¹¶æ˜¾ç¤ºæœ€é•¿è¿ç»­æ‰“å¡å¤©æ•°  
âœ… åˆ é™¤ä¸å†éœ€è¦çš„ RoutineTaskItem ç»„ä»¶  
âœ… ç®€åŒ–ä»£ç ç»“æ„ï¼Œæé«˜å¯ç»´æŠ¤æ€§  
âœ… ä¼˜åŒ–æ€§èƒ½ï¼ŒåŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦  

ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
- åœ¨è“è‰²é¡µé¢å¿«é€Ÿç®¡ç†æ—¥å¸¸ä»»åŠ¡
- åœ¨ç»¿è‰²é¡µé¢æŸ¥çœ‹ä¹ æƒ¯å…»æˆè¿›åº¦
- é€šè¿‡å¯è§†åŒ–æ•°æ®è·å¾—æ¿€åŠ±å’Œæˆå°±æ„Ÿ

---

**é‡æ„å®Œæˆæ—¥æœŸ**ï¼š2025å¹´11æœˆ26æ—¥  
**é‡æ„ç›®æ ‡**ï¼šâœ… å…¨éƒ¨å®Œæˆ  
**ä»£ç è´¨é‡**ï¼šâœ… æ—  linter é”™è¯¯  
**åŠŸèƒ½æµ‹è¯•**ï¼šâœ… å¾…ç”¨æˆ·æµ‹è¯•

