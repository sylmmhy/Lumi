# æœ¬åœ° Supabase å¼€å‘ç¯å¢ƒå®Œå–„è®¡åˆ’

---
title: æœ¬åœ° Supabase å¼€å‘ç¯å¢ƒå®Œå–„
stage: ğŸš§ è¿›è¡Œä¸­
started: 2026-01-16
updated: 2026-01-16
due: 2026-01-20
owner: dev-team
---

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†é˜²æ­¢æ„å¤–ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒ Supabase æ•°æ®åº“ï¼Œé¡¹ç›®å·²å¼€å§‹æ­å»ºæœ¬åœ° Supabase å¼€å‘ç¯å¢ƒã€‚æœ¬æ–‡æ¡£è®°å½•å½“å‰å®Œæˆæƒ…å†µå’Œå¾…åŠäº‹é¡¹ã€‚

---

## âœ… å·²å®Œæˆçš„éƒ¨åˆ†

### 1. åŸºç¡€é…ç½® âœ…

| é¡¹ç›® | çŠ¶æ€ | æ–‡ä»¶è·¯å¾„ |
|------|------|---------|
| Supabase æœ¬åœ°é…ç½® | âœ… å®Œæˆ | `supabase/config.toml` |
| ç¯å¢ƒå˜é‡é¢„è®¾ï¼ˆæœ¬åœ°ï¼‰ | âœ… å®Œæˆ | `.env.supabase-local` |
| ç¯å¢ƒå˜é‡é¢„è®¾ï¼ˆè¿œç¨‹ï¼‰ | âœ… å®Œæˆ | `.env.supabase-remote` |
| Edge Functions å¯†é’¥æ¨¡æ¿ | âœ… å®Œæˆ | `supabase/.env.local.example` |

### 2. npm è„šæœ¬ âœ…

```json
{
  "dev:local": "npm run use:local && vite",
  "dev:remote": "npm run use:remote && vite",
  "use:local": "cp .env.supabase-local .env.local",
  "use:remote": "cp .env.supabase-remote .env.local",
  "supabase:start": "supabase start",
  "supabase:stop": "supabase stop",
  "supabase:status": "supabase status",
  "supabase:push": "supabase db push --linked",
  "supabase:deploy": "supabase functions deploy",
  "supabase:sync": "ä¸€é”®åŒæ­¥åˆ°è¿œç«¯ï¼ˆè¿ç§» + å‡½æ•°ï¼‰"
}
```

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# ============================================
# ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨æœ¬åœ° Supabaseï¼ˆé¦–æ¬¡æˆ–é‡å¯åï¼‰
# ============================================
npm run supabase:start
# ç­‰å¾…æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦ 30 ç§’ï¼‰

# ============================================
# ç¬¬äºŒæ­¥ï¼šå¯åŠ¨æœ¬åœ°å‰ç«¯å¼€å‘
# ============================================
npm run dev:local
# è®¿é—® http://localhost:5173

# ============================================
# ç¬¬ä¸‰æ­¥ï¼šåœ¨æœ¬åœ°è¿›è¡Œåç«¯ä¿®æ”¹
# ============================================
# - ä¿®æ”¹æ•°æ®åº“ï¼šç¼–è¾‘ supabase/migrations/ ä¸­çš„ SQL æ–‡ä»¶
# - ä¿®æ”¹å‡½æ•°ï¼šç¼–è¾‘ supabase/functions/ ä¸­çš„ TypeScript æ–‡ä»¶
# - æœ¬åœ°æµ‹è¯•éªŒè¯...

# ============================================
# ç¬¬å››æ­¥ï¼šæµ‹è¯•å®Œæˆåï¼Œä¸€é”®åŒæ­¥åˆ°è¿œç«¯
# ============================================
npm run supabase:sync
# ğŸš€ è‡ªåŠ¨æ‰§è¡Œï¼š
#   1. æ¨é€æ•°æ®åº“è¿ç§» (supabase db push)
#   2. éƒ¨ç½²æ‰€æœ‰ Edge Functions (supabase functions deploy)
# âœ… åŒæ­¥å®Œæˆï¼

# ============================================
# æ”¶å·¥ï¼šåœæ­¢æœ¬åœ° Supabase
# ============================================
npm run supabase:stop
```

### å‘½ä»¤é€ŸæŸ¥è¡¨

| å‘½ä»¤ | ç”¨é€” | ä½•æ—¶ä½¿ç”¨ |
|------|------|---------|
| `npm run supabase:start` | å¯åŠ¨æœ¬åœ° Supabase æœåŠ¡ | å¼€å§‹å¼€å‘æ—¶ |
| `npm run supabase:stop` | åœæ­¢æœ¬åœ° Supabase æœåŠ¡ | ç»“æŸå¼€å‘æ—¶ |
| `npm run supabase:status` | æŸ¥çœ‹æœ¬åœ°æœåŠ¡çŠ¶æ€ | æ£€æŸ¥æ˜¯å¦æ­£å¸¸è¿è¡Œ |
| `npm run dev:local` | å¯åŠ¨å‰ç«¯ + è¿æ¥æœ¬åœ° Supabase | æ—¥å¸¸å¼€å‘ |
| `npm run dev:remote` | å¯åŠ¨å‰ç«¯ + è¿æ¥è¿œç«¯ Supabase | ç´§æ€¥ä¿®å¤/æµ‹è¯•ç”Ÿäº§æ•°æ® |
| `npm run supabase:push` | åªæ¨é€æ•°æ®åº“è¿ç§» | åªæ”¹äº†æ•°æ®åº“ |
| `npm run supabase:deploy` | åªéƒ¨ç½² Edge Functions | åªæ”¹äº†å‡½æ•° |
| **`npm run supabase:sync`** | **ä¸€é”®åŒæ­¥å…¨éƒ¨** | **æ”¹å®Œè¦ä¸Šçº¿æ—¶** |

### æœ¬åœ°æœåŠ¡åœ°å€

å¯åŠ¨æœ¬åœ° Supabase åï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

| æœåŠ¡ | åœ°å€ | ç”¨é€” |
|------|------|------|
| API (PostgREST) | https://127.0.0.1:54321 | å‰ç«¯è°ƒç”¨çš„ API |
| Studio (ä»ªè¡¨ç›˜) | http://127.0.0.1:54323 | å¯è§†åŒ–ç®¡ç†æ•°æ®åº“ |
| Inbucket (é‚®ä»¶) | http://127.0.0.1:54324 | æŸ¥çœ‹æµ‹è¯•é‚®ä»¶ |
| æ•°æ®åº“ (PostgreSQL) | localhost:54322 | ç›´æ¥è¿æ¥æ•°æ®åº“ |

---

### 3. å‰ç«¯å®¢æˆ·ç«¯ âœ…

- `src/lib/supabase.ts` å·²æ”¯æŒæ ¹æ®ç¯å¢ƒå˜é‡è‡ªåŠ¨åˆ‡æ¢æœ¬åœ°/è¿œç¨‹ Supabase
- æ”¯æŒ HTTPS (TLS) æœ¬åœ° API

### 4. æ•°æ®åº“åˆå§‹åŒ– âœ…

- `supabase/migrations/00000000000000_init.sql` - åŒ…å«å®Œæ•´çš„æ•°æ®åº“ schema
- `supabase/migrations_backup/` - åŒ…å«æ‰€æœ‰å¢é‡è¿ç§»è®°å½•

### 5. Edge Functions é…ç½® âœ…

- `config.toml` ä¸­å·²é…ç½® 40+ ä¸ª Edge Functions
- å·²åŒºåˆ† JWT éªŒè¯ï¼ˆç™»å½•/æœªç™»å½•ï¼‰çš„ functions

---

## âŒ å¾…å®Œæˆçš„éƒ¨åˆ†

### ä¼˜å…ˆçº§: é«˜ (P0)

#### 1. ğŸ“ æœ¬åœ° Supabase å¼€å‘æŒ‡å—æ–‡æ¡£

**éœ€è¦**: åˆ›å»º `docs/dev-guide/local-supabase.md`

åº”åŒ…å«å†…å®¹ï¼š
- [ ] Docker å®‰è£…è¦æ±‚è¯´æ˜
- [ ] `supabase start` å¯åŠ¨æ­¥éª¤
- [ ] TLS è‡ªç­¾åè¯ä¹¦ä¿¡ä»»æ–¹æ³•ï¼ˆmacOS/Windowsï¼‰
- [ ] æœ¬åœ° Studio è®¿é—®è¯´æ˜ (http://127.0.0.1:54323)
- [ ] æœ¬åœ° Inbucket é‚®ä»¶æµ‹è¯•è¯´æ˜ (http://127.0.0.1:54324)
- [ ] å¸¸è§é—®é¢˜æ’æŸ¥

**åŸå› **: æ–°å¼€å‘è€…éœ€è¦å®Œæ•´çš„ä¸Šæ‰‹æŒ‡å—

---

#### 2. ğŸŒ± Seed æ•°æ®æ–‡ä»¶

**éœ€è¦**: åˆ›å»º `supabase/seed.sql`

åº”åŒ…å«å†…å®¹ï¼š
- [ ] æµ‹è¯•ç”¨æˆ·è´¦å·ï¼ˆå¸¦å¯†ç å“ˆå¸Œï¼‰
- [ ] ç¤ºä¾‹ä»»åŠ¡æ•°æ®
- [ ] ç¤ºä¾‹ä¹ æƒ¯æ•°æ®
- [ ] ç¤ºä¾‹è®°å¿†æ•°æ®
- [ ] è®¿å®¢æµ‹è¯•æ•°æ®

**åŸå› **: æ¯æ¬¡ `supabase db reset` åèƒ½è‡ªåŠ¨å¡«å……æµ‹è¯•æ•°æ®

---

#### 3. ğŸ”§ è¿ç§»æ–‡ä»¶æ•´åˆ

**å½“å‰çŠ¶æ€**:
- `migrations/` åªæœ‰ä¸€ä¸ª `00000000000000_init.sql` (118KB)
- `migrations_backup/` æœ‰ 18 ä¸ªå¢é‡è¿ç§»æ–‡ä»¶

**éœ€è¦**:
- [ ] ç¡®è®¤ `init.sql` æ˜¯å¦åŒ…å«æ‰€æœ‰å¢é‡è¿ç§»çš„å†…å®¹
- [ ] å†³å®šæ˜¯å¦éœ€è¦ä¿ç•™å¢é‡è¿ç§»æ–‡ä»¶ï¼ˆç”¨äºå†å²è¿½æº¯ï¼‰
- [ ] æ›´æ–° `config.toml` ä¸­çš„ `schema_paths` é…ç½®

---

### ä¼˜å…ˆçº§: ä¸­ (P1)

#### 4. ğŸ§ª æœ¬åœ°ç¯å¢ƒéªŒè¯è„šæœ¬

**éœ€è¦**: åˆ›å»º `scripts/verify-local-supabase.sh`

åŠŸèƒ½ï¼š
- [ ] æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
- [ ] æ£€æŸ¥ Supabase æœåŠ¡æ˜¯å¦å¯åŠ¨
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥
- [ ] æµ‹è¯• API ç«¯ç‚¹
- [ ] æµ‹è¯• Auth æœåŠ¡
- [ ] è¾“å‡ºè¯Šæ–­æŠ¥å‘Š

**åŸå› **: å¿«é€ŸéªŒè¯æœ¬åœ°ç¯å¢ƒæ˜¯å¦æ­£å¸¸å·¥ä½œ

---

#### 5. ğŸ” OAuth æœ¬åœ°æµ‹è¯•é…ç½®è¯´æ˜

**éœ€è¦**: æ›´æ–° `docs/dev-guide/local-supabase.md`

å†…å®¹ï¼š
- [ ] Google OAuth æœ¬åœ°å›è°ƒé…ç½®ï¼ˆlocalhost:5173ï¼‰
- [ ] Apple OAuth æœ¬åœ°æµ‹è¯•é™åˆ¶è¯´æ˜
- [ ] ä½¿ç”¨ Inbucket æ›¿ä»£é‚®ä»¶éªŒè¯çš„æ–¹æ³•

**åŸå› **: OAuth åœ¨æœ¬åœ°æµ‹è¯•æœ‰ç‰¹æ®Šé…ç½®éœ€æ±‚

---

#### 6. ğŸ“¦ Docker Compose é…ç½®ï¼ˆå¯é€‰ï¼‰

**éœ€è¦**: è€ƒè™‘åˆ›å»º `docker-compose.override.yml`

ç”¨é€”ï¼š
- [ ] è‡ªå®šä¹‰æœ¬åœ° Supabase å®¹å™¨é…ç½®
- [ ] æ•°æ®æŒä¹…åŒ–å·é…ç½®
- [ ] ç½‘ç»œé…ç½®

**åŸå› **: æ›´çµæ´»åœ°æ§åˆ¶æœ¬åœ°å¼€å‘ç¯å¢ƒ

---

### ä¼˜å…ˆçº§: ä½ (P2)

#### 7. ğŸ”„ CI/CD é›†æˆ

**éœ€è¦**: æ›´æ–° GitHub Actions

å†…å®¹ï¼š
- [ ] æ·»åŠ æœ¬åœ° Supabase åˆ° CI æµ‹è¯•æµç¨‹
- [ ] è‡ªåŠ¨è¿è¡Œè¿ç§»æµ‹è¯•
- [ ] è‡ªåŠ¨éªŒè¯ Edge Functions

---

#### 8. ğŸ“Š æœ¬åœ°æ•°æ®æŒä¹…åŒ–è¯´æ˜

**éœ€è¦**: æ–‡æ¡£è¯´æ˜

å†…å®¹ï¼š
- [ ] `supabase stop` vs `supabase stop --no-backup` çš„åŒºåˆ«
- [ ] æ•°æ®å­˜å‚¨ä½ç½®ï¼ˆ`.supabase/` ç›®å½•ï¼‰
- [ ] å¦‚ä½•å¤‡ä»½/æ¢å¤æœ¬åœ°æ•°æ®

---

#### 9. ğŸŒ ç½‘ç»œé…ç½®è¯´æ˜

**éœ€è¦**: æ–‡æ¡£è¯´æ˜

å†…å®¹ï¼š
- [ ] æœ¬åœ°ç«¯å£å ç”¨è¡¨ï¼ˆ54321-54327ï¼‰
- [ ] ç«¯å£å†²çªè§£å†³æ–¹æ³•
- [ ] å¤šé¡¹ç›®åŒæ—¶å¼€å‘çš„é…ç½®

---

## ğŸ“ å½“å‰ç›®å½•ç»“æ„

```
supabase/
â”œâ”€â”€ .env.local           # Edge Functions å¯†é’¥ï¼ˆgit ignoredï¼‰
â”œâ”€â”€ .env.local.example   # å¯†é’¥æ¨¡æ¿
â”œâ”€â”€ config.toml          # æœ¬åœ° Supabase é…ç½®
â”œâ”€â”€ functions/           # 40+ Edge Functions
â”‚   â”œâ”€â”€ _shared/         # å…±äº«åº“
â”‚   â”œâ”€â”€ memory-extractor/
â”‚   â”œâ”€â”€ get-system-instruction/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ 00000000000000_init.sql
â””â”€â”€ migrations_backup/   # å†å²è¿ç§»å¤‡ä»½
    â”œâ”€â”€ 20260108000000_create_user_memories.sql
    â”œâ”€â”€ 20260108010000_add_task_name_to_user_memories.sql
    â””â”€â”€ ... (å…±18ä¸ªæ–‡ä»¶)
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ (ä»Šå¤©)

1. **åˆ›å»ºæœ¬åœ°å¼€å‘æŒ‡å—** - `docs/dev-guide/local-supabase.md`
2. **åˆ›å»º Seed æ•°æ®** - `supabase/seed.sql`

### æœ¬å‘¨å®Œæˆ

3. **éªŒè¯è¿ç§»å®Œæ•´æ€§** - ç¡®è®¤ init.sql åŒ…å«æ‰€æœ‰å¿…è¦ schema
4. **åˆ›å»ºéªŒè¯è„šæœ¬** - `scripts/verify-local-supabase.sh`

### åç»­è¿­ä»£

5. OAuth æœ¬åœ°æµ‹è¯•æ–‡æ¡£
6. CI/CD é›†æˆ

---

## ğŸ“ å®ç°è®°å½•

### 2026-01-16

- å®Œæˆç°çŠ¶åˆ†æ
- åˆ›å»ºæœ¬è®¡åˆ’æ–‡æ¡£
- ç¡®è®¤å·²å®Œæˆå’Œå¾…å®Œæˆé¡¹ç›®
- âœ… æ·»åŠ ä¸€é”®åŒæ­¥å‘½ä»¤ `npm run supabase:sync`
- âœ… æ·»åŠ æœ¬åœ° Supabase ç®¡ç†å‘½ä»¤ï¼ˆstart/stop/statusï¼‰
- âœ… æ·»åŠ å¿«é€Ÿä½¿ç”¨æŒ‡å—å’Œå‘½ä»¤é€ŸæŸ¥è¡¨

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- é…ç½®æ–‡ä»¶: `supabase/config.toml`
- å¯†é’¥æ¨¡æ¿: `supabase/.env.local.example`
- ç¯å¢ƒåˆ‡æ¢: `.env.supabase-local`, `.env.supabase-remote`
- å‰ç«¯å®¢æˆ·ç«¯: `src/lib/supabase.ts`
- éƒ¨ç½²æŒ‡å—: `docs/dev-guide/deployment.md`
