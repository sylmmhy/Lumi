---
title: "åŠ¨æ€è™šæ‹Ÿæ¶ˆæ¯ç³»ç»Ÿ"
created: 2026-01-27
updated: 2026-01-31 12:00
stage: "ğŸ”¨ å®ç°ä¸­"
due: 2026-02-10
issue: ""
---

# åŠ¨æ€è™šæ‹Ÿæ¶ˆæ¯ç³»ç»Ÿ å®ç°è¿›åº¦

## é˜¶æ®µè¿›åº¦
- [x] é˜¶æ®µ 1ï¼šéœ€æ±‚åˆ†æ
- [x] é˜¶æ®µ 2ï¼šæ–¹æ¡ˆè®¾è®¡
- [x] é˜¶æ®µ 3ï¼šæ ¸å¿ƒå®ç°ï¼ˆåŸºç¡€è®¾æ–½ï¼‰âœ… 2026-01-28
  - [x] åˆ›å»º `_shared/memory-retrieval.ts` å…±äº«æ¨¡å—
  - [x] åˆ›å»º `retrieve-memories` Edge Function
  - [x] åˆ›å»ºå‰ç«¯ `virtual-messages` hooks
  - [ ] ä¿®æ”¹ `get-system-instruction` ä½¿ç”¨å…±äº«æ¨¡å—ï¼ˆå¯é€‰ï¼‰
- [x] é˜¶æ®µ 3.5ï¼šè¯­è¨€ä¸€è‡´æ€§ä¿®å¤ âœ… 2026-01-27
  - [x] ä¿®å¤è§¦å‘è¯è¯­è¨€æ±¡æŸ“é—®é¢˜ï¼ˆæ‰€æœ‰è§¦å‘è¯æºå¸¦ `language=` å‚æ•°ï¼‰
  - [x] ä¿®å¤ ToneManager è¯­æ°”åˆ‡æ¢æ—¶çš„è¯­è¨€æ±¡æŸ“
  - [x] æ›´æ–°ç³»ç»ŸæŒ‡ä»¤ï¼Œå¼ºåˆ¶ AI éµå¾ª `language=` å‚æ•°
- [x] é˜¶æ®µ 3.6ï¼šæ–¹æ¡ˆ A é™é»˜æ³¨å…¥å®ç° âœ… 2026-01-28
  - [x] åœ¨ `useGeminiSession` æ·»åŠ  `sendClientContent` æ–¹æ³•
  - [x] åœ¨ `useGeminiLive` æ·»åŠ  `injectContextSilently` æ–¹æ³•
  - [x] åˆ›å»º `useVirtualMessageQueue.ts` æ¶ˆæ¯é˜Ÿåˆ—
  - [x] åˆ›å»º `useVirtualMessageOrchestrator.ts` æ ¸å¿ƒè°ƒåº¦å™¨
- [x] é˜¶æ®µ 3.7ï¼šæ–¹æ¡ˆ 1 ç«‹å³æ‰“æ–­å®ç° âœ… 2026-01-31
  - [x] ä¿®æ”¹ `sendClientContent` æ”¯æŒ `role='system'` å‚æ•°
  - [x] åœ¨ Orchestrator ä¸­å®ç°ã€ŒAI è¯´è¯æ—¶ç«‹å³æ‰“æ–­å¹¶æ³¨å…¥ã€é€»è¾‘
- [x] é˜¶æ®µ 4ï¼šé›†æˆåˆ° useAICoachSession âœ… 2026-01-28
  - [x] åˆå§‹åŒ– `useVirtualMessageOrchestrator` è°ƒåº¦å™¨
  - [x] åœ¨ `onTranscriptUpdate` ä¸­è°ƒç”¨ `onUserSpeech` å’Œ `onAISpeech`
  - [x] åœ¨ `setOnTurnComplete` ä¸­è°ƒç”¨ `onTurnComplete`
  - [x] æš´éœ²è°ƒè¯•æ–¹æ³•ï¼š`orchestratorQueueSize`ã€`triggerMemoryRetrieval`
- [ ] é˜¶æ®µ 5ï¼šæµ‹è¯•éªŒè¯
- [ ] é˜¶æ®µ 6ï¼šæ–‡æ¡£æ›´æ–°
- [ ] **é˜¶æ®µ 3.8ï¼šæ–¹æ¡ˆ 2 è¿‡æ¸¡è¯æ³¨å…¥** â³ å¾…å®ç°
  - [ ] ç”¨æˆ·è¯´å®Œè¯åç«‹åˆ»æ³¨å…¥è®°å¿†ï¼ˆä¸å…¥é˜Ÿç­‰å¾…ï¼‰
  - [ ] åˆ é™¤å®šæ—¶è‡ªåŠ¨å‘é€è™šæ‹Ÿæ¶ˆæ¯åŠŸèƒ½
  - [ ] åœ¨ System Prompt ä¸­æ·»åŠ è¿‡æ¸¡è¯æŒ‡ä»¤

---

## ğŸ†• æ–¹æ¡ˆ 2ï¼šè¿‡æ¸¡è¯æ³¨å…¥ï¼ˆ2026-01-31 å†³ç­–ï¼‰

### èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆä¸ç”¨å…¥é˜Ÿç­‰å¾…ï¼Ÿ

1. **`turnComplete=false` ä¼šé˜»å¡åç»­è¯­éŸ³è¾“å…¥**ï¼ˆå®˜æ–¹ API é™åˆ¶ï¼‰
2. å…¥é˜Ÿç­‰å¾…ä¼šå¯¼è‡´æ¶ˆæ¯å‘ä¸å‡ºå»
3. å¯¹è¯åˆ‡æ¢æ—¶ä¸Šä¸‹æ–‡å¯èƒ½å·²è¿‡æ—¶

**å‚è€ƒæ¥æº**ï¼š
- [Live API Hidden context - Google AI Forum](https://discuss.ai.google.dev/t/live-api-hidden-context/66495)
- [turnComplete=false prevents RealtimeInputMessage](https://discuss.ai.google.dev/t/turncomplete-flag-set-to-false-in-clientcontentmessage-of-multimodal-live-api-prevents-processing-of-subsequent-realtimeinputmessage/62949)

### æ–¹æ¡ˆè®¾è®¡

**æ—¶åº**ï¼š
```
ç”¨æˆ·è¯´è¯: "I miss my boyfriend"
    â†“
æ£€æµ‹è¯é¢˜ + æ£€ç´¢è®°å¿† (1-2ç§’)
    â†“
æ³¨å…¥ [CONTEXT] + turnComplete=true
    â†“
AI è¯´è¿‡æ¸¡è¯: "I hear you..." (åŒæ—¶åœ¨å†…éƒ¨æ¶ˆåŒ–è®°å¿†)
    â†“
AI ç»§ç»­: "...Tom means a lot to you, right?"
```

**System Prompt æ·»åŠ **ï¼š
```
When you receive a [CONTEXT] message, DO NOT say "ok" or "got it".
Instead, use a natural filler phrase based on the emotional tone:

- Sad/emotional â†’ "I hear you...", "That sounds tough..."
- Question/curious â†’ "That's an interesting question...", "Let me think..."
- Frustrated â†’ "I get it...", "That makes sense..."
- Neutral â†’ "Mmhmm...", "Right..."

Then seamlessly continue with your response using the context provided.
```

### è¦åˆ é™¤çš„åŠŸèƒ½

- `cooldownMs` å®šæ—¶è‡ªåŠ¨å‘é€
- æ¶ˆæ¯é˜Ÿåˆ—å…¥é˜Ÿé€»è¾‘ï¼ˆæ”¹ä¸ºç«‹åˆ»æ³¨å…¥ï¼‰

### å¾…å®ç°çš„æ”¹åŠ¨

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `useVirtualMessageOrchestrator.ts` | åˆ é™¤é˜Ÿåˆ—ï¼Œæ”¹ä¸ºç«‹åˆ» `sendClientContent` |
| `useVirtualMessageQueue.ts` | å¯èƒ½åˆ é™¤æˆ–ç®€åŒ– |
| `get-system-instruction` | æ·»åŠ è¿‡æ¸¡è¯æŒ‡ä»¤ |

---

## 12. å®ç°è¿›åº¦æ€»ç»“ï¼ˆ2026-01-31 æ›´æ–°ï¼‰

### 12.1 å·²å®Œæˆçš„åŠŸèƒ½

#### âœ… åº•å±‚ APIï¼š`sendClientContent` æ”¯æŒ system role

**æ–‡ä»¶**ï¼š`src/hooks/gemini-live/core/useGeminiSession.ts`

**æ”¹åŠ¨**ï¼š
```typescript
/**
 * å‘é€å®¢æˆ·ç«¯å†…å®¹ï¼ˆæ”¯æŒé™é»˜æ³¨å…¥ä¸Šä¸‹æ–‡ï¼‰
 * @param content - è¦æ³¨å…¥çš„æ–‡æœ¬å†…å®¹
 * @param turnComplete - æ˜¯å¦è§¦å‘ AI å“åº”ï¼Œé»˜è®¤ falseï¼ˆé™é»˜æ³¨å…¥ï¼‰
 * @param role - æ¶ˆæ¯è§’è‰²ï¼Œé»˜è®¤ 'user'ï¼Œå¯é€‰ 'system' ç”¨äºæ³¨å…¥ä¸Šä¸‹æ–‡/è®°å¿†
 */
sendClientContent: (content: string, turnComplete?: boolean, role?: 'user' | 'system') => void;
```

**å®ç°ç»†èŠ‚**ï¼š
- æ”¯æŒ `role='system'` å‚æ•°ï¼Œè®© AI æŠŠæ³¨å…¥çš„å†…å®¹å½“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡è€Œéç”¨æˆ·é—®é¢˜
- å…¼å®¹æ–°æ—§ç‰ˆ SDKï¼ˆä¼˜å…ˆä½¿ç”¨ `sendClientContent` æ–¹æ³•ï¼Œå›é€€åˆ° `send` æ–¹æ³•ï¼‰

#### âœ… æ–¹æ¡ˆ 1ï¼šAI è¯´è¯æ—¶ç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†

**æ–‡ä»¶**ï¼š`src/hooks/virtual-messages/useVirtualMessageOrchestrator.ts`

**æ ¸å¿ƒé€»è¾‘**ï¼š
```typescript
// å¦‚æœ AI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†
if (isSpeakingRef.current) {
  console.log(`ğŸš¨ [æ–¹æ¡ˆ 1 + system role] AI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†`)
  // turnComplete=true æ‰“æ–­ AIï¼Œrole='system' ç¡®ä¿æ˜¯ä¸Šä¸‹æ–‡
  sendClientContent(contextMessage, true, 'system')
} else {
  // AI æ²¡åœ¨è¯´è¯ï¼Œå…¥é˜Ÿç­‰å¾… turnComplete åé™é»˜æ³¨å…¥
  messageQueue.enqueue({ type: 'CONTEXT', ... })
}
```

#### âœ… å‘é‡åŒ¹é…è¯é¢˜æ£€æµ‹ï¼ˆMulti-Query RAGï¼‰

**åç«¯**ï¼š`supabase/functions/detect-topic/index.ts`

**å®ç°**ï¼š
- ä½¿ç”¨ Gemini 2.0 Flash Lite ç”Ÿæˆ embedding
- ä¸é¢„è®¡ç®—çš„è¯é¢˜ embeddings åšå‘é‡åŒ¹é…
- è¿”å›åŒ¹é…åº¦æœ€é«˜çš„è¯é¢˜åŠå¯¹åº”çš„è®°å¿†æ£€ç´¢é—®é¢˜

**å‰ç«¯**ï¼š`src/hooks/virtual-messages/useTopicDetector.ts`

**å®ç°**ï¼š
- è°ƒç”¨ `detect-topic` API è¿›è¡Œå‘é‡åŒ¹é…
- æœ¬åœ°æƒ…ç»ªæ£€æµ‹ä½œä¸º fallbackï¼ˆåŸºäºå…³é”®è¯ï¼‰
- æ”¯æŒè¯é¢˜å˜åŒ–æ£€æµ‹ï¼ˆé¿å…é‡å¤è§¦å‘ï¼‰

#### âœ… å¼‚æ­¥è®°å¿†æ£€ç´¢ç®¡é“

**åç«¯**ï¼š`supabase/functions/retrieve-memories/index.ts`

**å®ç°**ï¼š
- æ¥æ”¶è¯é¢˜å’Œç§å­é—®é¢˜
- æ‰§è¡Œ Multi-Query RAGï¼ˆå¤šä¸ªé—®é¢˜å¹¶è¡Œæœç´¢ï¼‰
- MRR èåˆæ’åºï¼Œè¿”å›æœ€ç›¸å…³çš„è®°å¿†

**å‰ç«¯**ï¼š`src/hooks/virtual-messages/useAsyncMemoryPipeline.ts`

**å®ç°**ï¼š
- è°ƒç”¨ `retrieve-memories` API
- ç”Ÿæˆæ ¼å¼åŒ–çš„ `[CONTEXT]` æ¶ˆæ¯
- æŒ‰è®°å¿†ç±»å‹ç»„ç»‡å†…å®¹ï¼ˆæœ‰æ•ˆæ¿€åŠ± > è¿‡å¾€ç»å† > åå¥½ > è¡Œä¸ºæ¨¡å¼ï¼‰

### 12.2 æ•°æ®æµå®Œæ•´æµç¨‹

```
ç”¨æˆ·è¯´: "I miss my boyfriend"
        â”‚
        â–¼
[1] useVirtualMessageOrchestrator.onUserSpeech(text)
        â”‚
        â”œâ”€â”€â–º contextTracker.addUserMessage(text)
        â”‚
        â””â”€â”€â–º topicDetector.detectFromMessage(text)
             â”‚ (è°ƒç”¨ detect-topic API)
             â–¼
[2] è¯é¢˜æ£€æµ‹å®Œæˆ: æ„Ÿæƒ…è¯é¢˜ï¼Œç½®ä¿¡åº¦ 44%
        â”‚
        â”œâ”€â”€â–º æ£€æµ‹åˆ°å¼ºçƒˆæƒ…ç»ª (sad, 0.7)
        â”‚    â””â”€â”€â–º å…¥é˜Ÿ [EMPATHY] æ¶ˆæ¯
        â”‚
        â””â”€â”€â–º è§¦å‘è®°å¿†æ£€ç´¢
             â”‚ (è°ƒç”¨ retrieve-memories API)
             â–¼
[3] è®°å¿†æ£€ç´¢å®Œæˆ: 4 æ¡è®°å¿†
        â”‚
        â””â”€â”€â–º ç”Ÿæˆ [CONTEXT] æ¶ˆæ¯
             â”‚
             â”œâ”€â”€â–º AI æ­£åœ¨è¯´è¯ï¼Ÿ
             â”‚    â””â”€â”€â–º YES: sendClientContent(msg, true, 'system') æ‰“æ–­å¹¶æ³¨å…¥
             â”‚    â””â”€â”€â–º NO:  messageQueue.enqueue(...) å…¥é˜Ÿç­‰å¾…
             â–¼
[4] AI é‡æ–°å“åº”ï¼Œè¿™æ¬¡ä¼šç”¨ä¸Š Tom çš„ä¿¡æ¯
```

---

## 13. è¸©è¿‡çš„å‘

### 13.1 âŒ å‘ 1ï¼š`sendClientContent` ä¸æ”¯æŒ `role='system'`

**é—®é¢˜**ï¼šæœ€åˆä»¥ä¸º Gemini Live API åªæ”¯æŒ `role='user'`ï¼Œå¯¼è‡´æ³¨å…¥çš„è®°å¿†è¢« AI å½“ä½œç”¨æˆ·é—®é¢˜æ¥å›ç­”ã€‚

**è¡¨ç°**ï¼š
- æ³¨å…¥ `[CONTEXT] ç”¨æˆ·çš„ç”·æœ‹å‹å« Tom...`
- AI å›å¤ï¼šã€ŒOh, so your boyfriend is Tom? That's nice!ã€ï¼ˆæŠŠè®°å¿†å½“é—®é¢˜ï¼‰

**è§£å†³**ï¼š
- æŸ¥é˜… [Google Vertex AI æ–‡æ¡£](https://cloud.google.com/vertex-ai/generative-ai/docs/live-api/streamed-conversations)
- å‘ç° `client_content` æ”¯æŒ `role: 'system'`
- ä¿®æ”¹ `sendClientContent` æ·»åŠ ç¬¬ä¸‰ä¸ªå‚æ•° `role`

**ä»£ç å˜åŒ–**ï¼š
```typescript
// Before
sendClientContent(content, true)  // AI ä¼šå½“ä½œç”¨æˆ·é—®é¢˜

// After
sendClientContent(content, true, 'system')  // AI ä¼šå½“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡
```

### 13.2 âŒ å‘ 2ï¼šè®°å¿†æ³¨å…¥æ—¶æœºå¤ªæ™š

**é—®é¢˜**ï¼šä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆturnComplete åé™é»˜æ³¨å…¥ï¼‰ï¼Œè®°å¿†æ³¨å…¥æ—¶ AI å·²ç»è¯´å®Œäº†ï¼Œç”¨ä¸ä¸Šè®°å¿†ã€‚

**è¡¨ç°**ï¼š
```
22:08:03  ç”¨æˆ·: "I miss my boyfriend"
22:08:06  è¯é¢˜æ£€æµ‹å®Œæˆ
22:08:14  è®°å¿†æ£€ç´¢å®Œæˆ (åŒ…å« Tom)
22:08:20  AI è¯´å®Œè¯ (turnComplete)
22:08:20  è®°å¿†æ³¨å…¥æˆåŠŸ â† ä½† AI å·²ç»å›å¤å®Œäº†ï¼
```

**è§£å†³**ï¼š
- æ”¹ç”¨æ–¹æ¡ˆ 1ï¼šAI è¯´è¯æ—¶ç«‹å³æ‰“æ–­å¹¶æ³¨å…¥
- æ£€æŸ¥ `isSpeakingRef.current`ï¼Œå¦‚æœ AI æ­£åœ¨è¯´è¯å°±ç«‹å³æ‰“æ–­

**ä»£ç å˜åŒ–**ï¼š
```typescript
if (isSpeakingRef.current) {
  // æ–¹æ¡ˆ 1ï¼šç«‹å³æ‰“æ–­
  sendClientContent(contextMessage, true, 'system')
} else {
  // æ–¹æ¡ˆ Aï¼šå…¥é˜Ÿç­‰å¾…
  messageQueue.enqueue(...)
}
```

### 13.3 âŒ å‘ 3ï¼šCONTEXT tag ä¸å­˜åœ¨

**é—®é¢˜**ï¼šå°è¯•æ’å…¥æµ‹è¯•è®°å¿†æ—¶ï¼Œä½¿ç”¨äº† `tag='CONTEXT'`ï¼Œä½†æ•°æ®åº“æœ‰çº¦æŸã€‚

**è¡¨ç°**ï¼š
```sql
INSERT INTO user_memories (..., tag, ...)
VALUES (..., 'CONTEXT', ...)
-- ERROR: new row violates check constraint "user_memories_tag_check"
```

**åŸå› **ï¼š`user_memories` è¡¨çš„ `tag` å­—æ®µæœ‰ CHECK çº¦æŸï¼Œåªå…è®¸ç‰¹å®šå€¼ã€‚

**è§£å†³**ï¼šæŸ¥è¯¢å·²æœ‰çš„ tag ç±»å‹ï¼š
```sql
SELECT DISTINCT tag FROM user_memories;
-- ç»“æœ: PROC, EMO, PREF, EFFECTIVE, SOMA
```

**æ•™è®­**ï¼š
- æµ‹è¯•æ—¶ä½¿ç”¨å·²æœ‰çš„ tagï¼ˆå¦‚ `EMO`ï¼‰
- æˆ–è€…éœ€è¦å…ˆä¿®æ”¹æ•°æ®åº“ schema æ·»åŠ æ–° tag

### 13.4 âŒ å‘ 4ï¼šè¯­è¨€æ±¡æŸ“é—®é¢˜

**é—®é¢˜**ï¼šç”¨æˆ·è®¾ç½®è‹±æ–‡ï¼Œä½†è§¦å‘è®°å¿†æ³¨å…¥å AI çªç„¶åˆ‡æ¢åˆ°ä¸­æ–‡ã€‚

**åŸå› **ï¼š
1. è§¦å‘è¯æ²¡æœ‰æºå¸¦ `language=` å‚æ•°
2. è®°å¿†å†…å®¹æ˜¯ä¸­æ–‡ï¼ŒAI è¢«ä¸­æ–‡å†…å®¹ã€Œå¸¦åã€

**è§£å†³**ï¼š
- æ‰€æœ‰è§¦å‘è¯éƒ½æºå¸¦ `language=` å‚æ•°
- åœ¨ System Instruction ä¸­å¼ºè°ƒå¿…é¡»éµå¾ª `language=` å‚æ•°

è¯¦è§æ–‡æ¡£ç¬¬ 10.1 èŠ‚ã€Œè¯­è¨€ä¸€è‡´æ€§æ–¹æ¡ˆã€ã€‚

### 13.5 âŒ å‘ 5ï¼šSDK æ–¹æ³•å…¼å®¹æ€§

**é—®é¢˜**ï¼šä¸åŒç‰ˆæœ¬çš„ `@google/genai` SDK æ–¹æ³•åä¸åŒã€‚

**è¡¨ç°**ï¼š
```
TypeError: session.sendClientContent is not a function
```

**åŸå› **ï¼šæ–°ç‰ˆ SDK ä½¿ç”¨ `sendClientContent`ï¼Œæ—§ç‰ˆä½¿ç”¨ `send`ã€‚

**è§£å†³**ï¼šæ·»åŠ å…¼å®¹å±‚ï¼š
```typescript
// ä¼˜å…ˆä½¿ç”¨æ–°ç‰ˆæ–¹æ³•
if (typeof session.sendClientContent === 'function') {
  session.sendClientContent({ turns, turnComplete })
}
// å›é€€åˆ°æ—§ç‰ˆæ–¹æ³•
else if (typeof session.send === 'function') {
  session.send({ client_content: { turns, turn_complete: turnComplete } })
}
```

---

## 14. æµ‹è¯•éªŒè¯æ–¹æ³•

### 14.1 è¯æ˜è®°å¿†æ˜¯åŠ¨æ€æ³¨å…¥çš„ï¼ˆè€Œéå¯åŠ¨æ—¶åŠ è½½ï¼‰

**æœ€ç®€å•çš„æ–¹æ³•**ï¼šä½¿ç”¨ç°æœ‰çš„ Tom è®°å¿†

1. **ç¡®è®¤ Tom è®°å¿†å­˜åœ¨ä¸” tag æ˜¯ EMO**ï¼š
   ```sql
   SELECT * FROM user_memories 
   WHERE content LIKE '%Tom%' AND user_id = '38396857-f948-4496-8ab2-80edbae72f16';
   -- åº”è¯¥çœ‹åˆ°: tag=EMO, content="ç”¨æˆ·æœ‰ä¸€ä¸ªç”·æœ‹å‹å« Tom"
   ```

2. **ç¡®è®¤ EMO ä¸åœ¨å¯åŠ¨é¢„åŠ è½½åˆ—è¡¨**ï¼š
   - å¯åŠ¨æ—¶åªåŠ è½½ `PREF`ã€`EFFECTIVE` ç­‰ tag
   - `EMO` ç±»å‹éœ€è¦é€šè¿‡å‘é‡åŒ¹é…åŠ¨æ€æ£€ç´¢

3. **æµ‹è¯•æ­¥éª¤**ï¼š
   - å¼€å§‹ä»»åŠ¡ "read a book"ï¼ˆå’Œæ„Ÿæƒ…æ— å…³ï¼‰
   - AI å¼€åœºåï¼Œé—®ï¼šã€ŒWhat's my boyfriend's name?ã€
     - é¢„æœŸï¼šAI è¯´ "I don't know"ï¼ˆå¯åŠ¨æ—¶æ²¡åŠ è½½ï¼‰
   - ç„¶åè¯´ï¼šã€ŒI really miss my boyfriendã€
   - ç­‰ AI å“åº”åï¼Œå†é—®ï¼šã€ŒSo what's his name?ã€
     - é¢„æœŸï¼šAI è¯´ "Tom"ï¼ˆåŠ¨æ€æ³¨å…¥æˆåŠŸï¼‰

4. **å…³é”®æ—¥å¿—éªŒè¯**ï¼š
   ```
   ğŸš¨ [æ–¹æ¡ˆ 1 + system role] AI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†
   ğŸ“¥ [GeminiSession] sendClientContent (role=system, turnComplete=true): [CONTEXT]...
   ```

### 14.2 æ—¥å¿—æ—¶åºåˆ†æ

```
å¯åŠ¨æ—¶æ—¥å¿—ï¼ˆä¸åº”è¯¥æœ‰ Tomï¼‰:
-------------------------------
ğŸ”‘ Fetching ephemeral token...
âœ… System instruction loaded
ğŸ“‹ å¯åŠ¨è®°å¿†: [PREF] ç”¨æˆ·å–œæ¬¢æå‰æ”¶æ‹¾è¡Œæ
ğŸ“‹ å¯åŠ¨è®°å¿†: [EFFECTIVE] ç•ªèŒ„é’Ÿå¯¹ç”¨æˆ·æœ‰æ•ˆ
ï¼ˆè¿™é‡Œä¸åº”è¯¥çœ‹åˆ° Tomï¼‰

è¯é¢˜è§¦å‘åæ—¥å¿—ï¼ˆåº”è¯¥çœ‹åˆ° Tomï¼‰:
-------------------------------
ğŸ¤ ç”¨æˆ·è¯´è¯: "I miss my boyfriend"
ğŸ” è¯é¢˜æ£€æµ‹å®Œæˆ: æ„Ÿæƒ… (44.0%)
ğŸ§  è®°å¿†æ£€ç´¢ç»“æœ: 4 æ¡
ğŸ§  è®°å¿†å†…å®¹: [EMO] ç”¨æˆ·æœ‰ä¸€ä¸ªç”·æœ‹å‹å« Tom â† Tom åœ¨è¿™é‡Œ
ğŸš¨ AI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†
```

---

## 15. ç›¸å…³ commit

### 2026-01-28
- `feat(virtual-messages): add system role support to sendClientContent`
- `feat(virtual-messages): implement æ–¹æ¡ˆ1 - interrupt AI and inject memory`
- `fix(virtual-messages): language pollution in tone triggers`

### 2026-01-29
- `feat(detect-topic): vector-based topic detection with Multi-Query RAG`
- `feat(retrieve-memories): async memory retrieval pipeline`

### 2026-01-31
- `feat(virtual-messages): integrate orchestrator with useAICoachSession`
- `docs: update dynamic virtual messages documentation`

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### é—®é¢˜
å½“å‰è™šæ‹Ÿæ¶ˆæ¯ç³»ç»Ÿçš„é—®é¢˜ï¼š
1. **æ— ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šè™šæ‹Ÿæ¶ˆæ¯ä¸çŸ¥é“ Gemini Live å½“å‰åœ¨èŠä»€ä¹ˆ
2. **é™æ€æ¨¡æ¿**ï¼šä½¿ç”¨å›ºå®šçš„è§¦å‘è¯æ ¼å¼ï¼Œæ— æ³•æ ¹æ®å¯¹è¯åŠ¨æ€è°ƒæ•´
3. **çªå…€æ„Ÿ**ï¼šæ³¨å…¥çš„æ¶ˆæ¯å¯èƒ½ä¸å½“å‰è¯é¢˜å®Œå…¨æ— å…³ï¼Œå¯¼è‡´ AI çªç„¶æ¢è¯é¢˜

### ç›®æ ‡
è®¾è®¡ä¸€ä¸ªå¹¶è¡Œäº Gemini Live çš„åŠ¨æ€è™šæ‹Ÿæ¶ˆæ¯ç³»ç»Ÿï¼š
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šçŸ¥é“å½“å‰å¯¹è¯çš„å®Œæ•´çŠ¶æ€
- **åŠ¨æ€ç”Ÿæˆ**ï¼šLLM æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆåˆé€‚çš„æŒ‡ä»¤
- **ä¼˜å…ˆçº§é˜Ÿåˆ—**ï¼šç´§æ€¥æŒ‡ä»¤ï¼ˆå¦‚æƒ…ç»ªå“åº”ï¼‰ä¼˜å…ˆå‘é€
- **å†²çªæ§åˆ¶**ï¼šé¿å…æ‰“æ–­æ­£åœ¨è¿›è¡Œçš„å¯¹è¯

---

## 2. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Gemini Live Session                        â”‚
â”‚               (System Instruction åªèƒ½è®¾ç½®ä¸€æ¬¡)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ å®æ—¶å¯¹è¯
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¯¹è¯ä¸Šä¸‹æ–‡è¿½è¸ªå™¨ (ConversationContextTracker)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ recentMessages: æœ€è¿‘ N æ¡æ¶ˆæ¯                         â”‚    â”‚
â”‚  â”‚  â€¢ currentTopic: å½“å‰è¯é¢˜                                â”‚    â”‚
â”‚  â”‚  â€¢ topicFlow: è¯é¢˜æµè½¬å†å²                               â”‚    â”‚
â”‚  â”‚  â€¢ emotionalState: æƒ…ç»ªçŠ¶æ€                              â”‚    â”‚
â”‚  â”‚  â€¢ conversationPhase: å¯¹è¯é˜¶æ®µ                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æä¾›ä¸Šä¸‹æ–‡
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            è™šæ‹Ÿæ¶ˆæ¯è°ƒåº¦å™¨ (VirtualMessageOrchestrator)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ è¯é¢˜æ£€æµ‹å™¨  â”‚  â”‚ å¼‚æ­¥è®°å¿†ç®¡é“  â”‚  â”‚ åŠ¨æ€æ¶ˆæ¯ç”Ÿæˆå™¨   â”‚          â”‚
â”‚  â”‚(å‘é‡åŒ¹é…)   â”‚  â”‚ (Mem0 æ£€ç´¢)  â”‚  â”‚ (LLM å¿«é€Ÿç”Ÿæˆ)  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚                â”‚                   â”‚                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â–¼                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚  æ¶ˆæ¯é˜Ÿåˆ— & å†²çªæ§åˆ¶  â”‚                            â”‚
â”‚              â”‚  (ä¼˜å…ˆçº§æ’åºã€å†·å´æœŸ)  â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æ³¨å…¥è™šæ‹Ÿæ¶ˆæ¯
                           â–¼
                    (sendClientContent)
```

---

## 3. æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶

```
src/hooks/virtual-messages/
â”œâ”€â”€ index.ts                              # å¯¼å‡ºå…¥å£
â”œâ”€â”€ types.ts                              # ç±»å‹å®šä¹‰ â­
â”œâ”€â”€ constants.ts                          # è¯é¢˜è§„åˆ™ã€æƒ…ç»ªè¯åº“
â”œâ”€â”€ useConversationContextTracker.ts      # å¯¹è¯ä¸Šä¸‹æ–‡è¿½è¸ªå™¨ â­â­â­
â”œâ”€â”€ useVirtualMessageOrchestrator.ts      # æ ¸å¿ƒè°ƒåº¦å™¨ â­â­â­
â”œâ”€â”€ useVirtualMessageQueue.ts             # æ¶ˆæ¯é˜Ÿåˆ— + å†²çªæ§åˆ¶
â”œâ”€â”€ useTopicDetector.ts                   # è¯é¢˜/æƒ…ç»ªæ£€æµ‹ï¼ˆå‘é‡åŒ¹é…ç‰ˆï¼‰
â””â”€â”€ useAsyncMemoryPipeline.ts             # å¼‚æ­¥è®°å¿†æ£€ç´¢ï¼ˆè°ƒç”¨ retrieve-memoriesï¼‰

supabase/functions/
â”œâ”€â”€ _shared/
â”‚   â”œâ”€â”€ memory-retrieval.ts               # Tolan è®°å¿†æ£€ç´¢å…±äº«æ¨¡å— â­â­â­
â”‚   â””â”€â”€ topic-embeddings.ts               # è¯é¢˜å‘é‡é¢„è®¡ç®—
â”œâ”€â”€ detect-topic/                         # å‘é‡åŒ¹é…è¯é¢˜æ£€æµ‹ API
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ retrieve-memories/                    # è™šæ‹Ÿæ¶ˆæ¯ä¸“ç”¨è®°å¿†æ£€ç´¢ API â­â­
â”‚   â””â”€â”€ index.ts
â””â”€â”€ get-system-instruction/
    â””â”€â”€ index.ts                          # æ·»åŠ  Dynamic Instruction æ®µè½
```

---

## 4. æ–¹æ¡ˆ 1ï¼šAI è¯´è¯æ—¶ç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†

### 4.1 èƒŒæ™¯é—®é¢˜

Gemini Live API åœ¨å¯¹è¯ä¸­é—´æ³¨å…¥ä¸Šä¸‹æ–‡æœ‰ä¸¤ä¸ªæ ¸å¿ƒæŒ‘æˆ˜ï¼š

1. **æ‰“æ–­é—®é¢˜**ï¼š`sendClientContent` ä¼šæ‰“æ–­å½“å‰æ­£åœ¨ç”Ÿæˆçš„å†…å®¹
2. **å“åº”é—®é¢˜**ï¼š`sendRealtimeInput` ä¼šè§¦å‘ AI å“åº”ï¼Œå¯èƒ½æ‰“æ–­ç”¨æˆ·

### 4.2 å®˜æ–¹ API åˆ†æ

æ ¹æ® [Google å®˜æ–¹æ–‡æ¡£](https://ai.google.dev/gemini-api/docs/live-guide)ï¼š

| æ–¹æ³• | ä¼šæ‰“æ–­ AI å—ï¼Ÿ | ä¼šè§¦å‘å“åº”å—ï¼Ÿ |
|------|-------------|--------------|
| `send_realtime_input` | âŒ ä¸ä¼š | âœ… ä¼šï¼ˆVAD æ£€æµ‹åï¼‰ |
| `send_client_content` + `turn_complete=true` | âœ… ä¼š | âœ… ä¼š |
| `send_client_content` + `turn_complete=false` | âœ… ä¼š | âŒ ä¸ä¼šï¼ˆé™é»˜æ³¨å…¥ï¼‰ |

**å…³é”®å‘ç°**ï¼š
- `turn_complete=false` å¯ä»¥æ·»åŠ å†…å®¹åˆ°ä¸Šä¸‹æ–‡ä½†**ä¸è§¦å‘ AI å“åº”**
- å¯ä»¥ä½¿ç”¨ `role='system'` æ¥æ³¨å…¥ä¸Šä¸‹æ–‡/è®°å¿†

### 4.3 æ–¹æ¡ˆè®¾è®¡

```
æ—¶é—´çº¿:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”¨æˆ·è¯´è¯ â”€â”€â–º è¯é¢˜æ£€æµ‹ â”€â”€â–º è®°å¿†æ£€ç´¢å®Œæˆ â”€â”€â–º AI æ­£åœ¨è¯´è¯ï¼Ÿ
                                              â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚                           â”‚
                              YES                          NO
                                â”‚                           â”‚
                                â–¼                           â–¼
                    sendClientContent               å…¥é˜Ÿç­‰å¾…
                    (msg, true, 'system')           turnComplete
                    æ‰“æ–­ AIï¼Œæ³¨å…¥è®°å¿†               åé™é»˜æ³¨å…¥
                                â”‚
                                â–¼
                    AI é‡æ–°å“åº”ï¼ˆç”¨ä¸Šè®°å¿†ï¼‰
```

### 4.4 æ ¸å¿ƒä»£ç 

```typescript
// useVirtualMessageOrchestrator.ts

if (isSpeakingRef.current) {
  // æ–¹æ¡ˆ 1ï¼šAI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥
  console.log(`ğŸš¨ [æ–¹æ¡ˆ 1 + system role] AI æ­£åœ¨è¯´è¯ï¼Œç«‹å³æ‰“æ–­å¹¶æ³¨å…¥è®°å¿†`)
  sendClientContent(contextMessage, true, 'system')
} else {
  // æ–¹æ¡ˆ Aï¼šAI æ²¡åœ¨è¯´è¯ï¼Œå…¥é˜Ÿç­‰å¾… turnComplete
  messageQueue.enqueue({
    type: 'CONTEXT',
    priority: 'normal',
    content: contextMessage,
  })
}
```

---

## 5. æ¶ˆæ¯åè®®è®¾è®¡

### 5.1 æŒ‡ä»¤ç±»å‹

| ç±»å‹ | ç”¨é€” | ä¼˜å…ˆçº§ | è§¦å‘æ¡ä»¶ |
|------|------|--------|---------|
| `[EMPATHY]` | æƒ…ç»ªå“åº” | urgent | æ£€æµ‹åˆ°å¼ºçƒˆæƒ…ç»ª |
| `[DIRECTIVE]` | è¡Œä¸ºæŒ‡ä»¤ | high | éœ€è¦å¼•å¯¼ AI è¡Œä¸º |
| `[CONTEXT]` | è®°å¿†æ³¨å…¥ | normal | æ£€ç´¢åˆ°ç›¸å…³è®°å¿† |
| `[CHECKPOINT]` | å®šæ—¶æ£€æŸ¥ | low | å®šæ—¶è§¦å‘ |

### 5.2 æŒ‡ä»¤æ ¼å¼

æ¯ä¸ªæŒ‡ä»¤éƒ½åŒ…å« `conversation_context` å­—æ®µï¼Œè®© AI çŸ¥é“å½“å‰å¯¹è¯çŠ¶æ€ï¼š

```
[CONTEXT] type=memory topic="å¤±æ‹"
conversation_context: ç”¨æˆ·æ­£åœ¨è®¨è®ºå¤±æ‹ï¼Œæƒ…ç»ªä½è½
ã€æœ‰æ•ˆæ¿€åŠ±ã€‘ç”¨æˆ·è¯´è¿åŠ¨èƒ½å¸®åŠ©è½¬ç§»æ³¨æ„åŠ›
ã€è¿‡å¾€ç»å†ã€‘ç”¨æˆ·ä¸Šæ¬¡å¤±æ‹åå»è·‘æ­¥ï¼Œæ„Ÿè§‰å¥½å¤šäº†
ã€ç”¨æˆ·åå¥½ã€‘ç”¨æˆ·æƒ…ç»ªä½è½æ—¶å–œæ¬¢å®‰é™ç‹¬å¤„
action: è‡ªç„¶åœ°å¼•ç”¨è¿™æ®µè®°å¿†ï¼Œä½†ä¸è¦æ‰“æ–­å½“å‰çš„æƒ…æ„Ÿå¯¹è¯ã€‚
```

---

## 6. è¯­è¨€ä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå·²å®ç°ï¼‰

### 6.1 é—®é¢˜èƒŒæ™¯

ç”¨æˆ·è®¾ç½®äº†è‹±æ–‡ä½œä¸ºé¦–é€‰è¯­è¨€ï¼Œä½†å½“ AI æ£€æµ‹åˆ°ç”¨æˆ·æŠ—æ‹’å¹¶è§¦å‘è¯­æ°”åˆ‡æ¢ï¼ˆ`[TONE_SHIFT]`ï¼‰æ—¶ï¼ŒAI çªç„¶åˆ‡æ¢åˆ°ä¸­æ–‡å›å¤ã€‚

**æ ¹æœ¬åŸå› **ï¼š
1. è§¦å‘è¯æ²¡æœ‰æºå¸¦è¯­è¨€ä¿¡æ¯
2. ç³»ç»ŸæŒ‡ä»¤ä¸­çš„ç¤ºä¾‹ä½¿ç”¨ä¸­æ–‡ï¼Œå¯èƒ½å½±å“ AI çš„è¯­è¨€é€‰æ‹©
3. AI åœ¨è¯­æ°”åˆ‡æ¢æ—¶"å¿˜è®°"äº†ç”¨æˆ·çš„è¯­è¨€åå¥½

### 6.2 è§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒæ€è·¯**ï¼šæ‰€æœ‰è§¦å‘è¯éƒ½æºå¸¦ `language=` å‚æ•°ï¼Œæ˜ç¡®å‘Šè¯‰ AI åº”è¯¥ç”¨ä»€ä¹ˆè¯­è¨€å›å¤ã€‚

**è§¦å‘è¯æ ¼å¼å˜åŒ–**ï¼š
```
[GREETING] current_time=17:34 language=en-US
[CHECK_IN] elapsed=2m current_time=17:36 language=en-US
[TONE_SHIFT] style=sneaky_friend current_time=17:38 language=en-US
[MEMORY_BOOST] type=past_success total=5 current_time=17:40 language=en-US
```

**ç³»ç»ŸæŒ‡ä»¤æ›´æ–°**ï¼š
```
IMPORTANT: Every trigger includes TWO critical parameters:
1. "current_time=HH:MM" (24-hour format, user's local time)
2. "language=XX" (e.g., language=en-US, language=zh-CN) - RESPOND IN THIS LANGUAGE

The "language=" parameter is MANDATORY. You MUST respond in the exact language specified.
```

---

## 7. æ€§èƒ½ç›®æ ‡

| æ“ä½œ | ç›®æ ‡å»¶è¿Ÿ | ç­–ç•¥ |
|------|---------|------|
| è¯é¢˜æ£€æµ‹ | < 500ms | å‘é‡åŒ¹é… API |
| è®°å¿†æ£€ç´¢ | < 1s | Multi-Query RAG |
| æ¶ˆæ¯ç”Ÿæˆ | < 100ms | æ¨¡æ¿ + æ ¼å¼åŒ– |
| **ç«¯åˆ°ç«¯** | **< 2s** | å¹¶è¡Œå¤„ç† |

---

## 8. å…³é”®é£é™©ä¸ç¼“è§£

| é£é™© | åæœ | ç¼“è§£æªæ–½ |
|------|------|---------|
| æ‰“æ–­å¤ªé¢‘ç¹ | ç”¨æˆ·ä½“éªŒå·® | å†·å´æœŸ + ä¼˜å…ˆçº§æ§åˆ¶ |
| è®°å¿†æ£€ç´¢å¤±è´¥ | æ— æ³•ä¸ªæ€§åŒ– | é™çº§åˆ°æ— è®°å¿†å“åº” |
| è¯­è¨€æ±¡æŸ“ | AI åˆ‡æ¢è¯­è¨€ | `language=` å‚æ•°å¼ºåˆ¶ |
| API å»¶è¿Ÿ | æ³¨å…¥å¤ªæ…¢ | æ–¹æ¡ˆ 1 ç«‹å³æ‰“æ–­ |
