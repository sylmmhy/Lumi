---
title: "æ—¥å¸¸å¯¹è¯åŠŸèƒ½"
created: 2026-02-03
updated: 2026-02-03 10:00
stage: "ğŸš§ å®ç°"
due: 2026-02-10
issue: ""
---

# æ—¥å¸¸å¯¹è¯åŠŸèƒ½ å®ç°è¿›åº¦

## é˜¶æ®µè¿›åº¦
- [x] é˜¶æ®µ 1ï¼šéœ€æ±‚åˆ†æ
- [x] é˜¶æ®µ 2ï¼šæ–¹æ¡ˆè®¾è®¡
- [x] é˜¶æ®µ 3ï¼šæ ¸å¿ƒå®ç°
- [ ] é˜¶æ®µ 4ï¼šæµ‹è¯•éªŒè¯
- [ ] é˜¶æ®µ 5ï¼šæ–‡æ¡£æ›´æ–°

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### èƒŒæ™¯
ç”¨æˆ·åœ¨ä½¿ç”¨ Lumi å…»æˆä¹ æƒ¯çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸€ä¸ªè½»æ¾çš„æ—¥å¸¸å¯¹è¯å…¥å£ï¼Œè®© AI ä¸»åŠ¨å…³å¿ƒç”¨æˆ·çŠ¶æ€ã€è¿½é—®è¢«è·³è¿‡çš„ä»»åŠ¡åŸå› ã€æ”¶é›†æƒ…ç»ªå’Œç”Ÿæ´»èƒŒæ™¯ä¿¡æ¯ã€‚

### ç›®æ ‡
1. **æ™ºèƒ½å¼€åœºç™½**ï¼šæ ¹æ®ç”¨æˆ·è¿‘å†µï¼ˆè·³è¿‡ä»»åŠ¡ã€è®°å¿†ã€è¿ç»­å®Œæˆå¤©æ•°ï¼‰ç”Ÿæˆä¸ªæ€§åŒ–å¼€åœº
2. **è®°å¿†æ”¶é›†**ï¼šé€šè¿‡å¯¹è¯æ”¶é›†ç”¨æˆ·çš„æ‹–å»¶åŸå› ï¼ˆPROCï¼‰ã€æƒ…ç»ªï¼ˆEMOï¼‰ã€åæœï¼ˆCONSEQUENCEï¼‰ã€ç”Ÿæ´»èƒŒæ™¯ï¼ˆCONTEXTï¼‰
3. **è‡ªç„¶å¯¹è¯**ï¼šåƒæœ‹å‹èŠå¤©ä¸€æ ·ï¼Œä¸è¯´æ•™ã€ä¸è´£å¤‡

---

## 2. æ–¹æ¡ˆè®¾è®¡

### 2.1 ä¸‰å±‚ AI æ¶æ„

ç”±äº Gemini Live çš„ Function Calling å­˜åœ¨æ–­çº¿ bugï¼Œé‡‡ç”¨ä¸‰å±‚ AI æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI #1: Gemini Live                                         â”‚
â”‚  - è´Ÿè´£å®æ—¶è¯­éŸ³å¯¹è¯                                          â”‚
â”‚  - ä¸ä½¿ç”¨ Function Callingï¼ˆé¿å… bugï¼‰                       â”‚
â”‚  - é€šè¿‡ System Prompt è·å¾—ä¸Šä¸‹æ–‡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI #2: useIntentDetectionï¼ˆå‰ç«¯ Hookï¼‰                      â”‚
â”‚  - ç›‘å¬ AI è¯´å®Œè¯                                            â”‚
â”‚  - æ£€æµ‹æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·                                       â”‚
â”‚  - è§¦å‘å·¥å…·è°ƒç”¨                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI #3: Edge Functionsï¼ˆå·¥å…·æ‰§è¡Œï¼‰                           â”‚
â”‚  - get_daily_report: è·å–æ¯æ—¥æŠ¥å‘Š                            â”‚
â”‚  - suggest_habit_stack: ä¹ æƒ¯å åŠ å»ºè®®                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¼€åœºç™½ç­–ç•¥

æŒ‰ä¼˜å…ˆçº§é€‰æ‹©å¼€åœºç™½ï¼š

| ä¼˜å…ˆçº§ | ç­–ç•¥ | è§¦å‘æ¡ä»¶ | ç¤ºä¾‹ |
|-------|------|---------|------|
| 1 | `task_skip` | æ˜¨å¤©æœ‰ä»»åŠ¡è¢«è·³è¿‡ | "æ˜¨å¤©é‚£ä¸ªã€ä»»åŠ¡åã€å¥½åƒæ²¡åšæˆï¼Ÿå‘ç”Ÿä»€ä¹ˆäº†å—ï½" |
| 2 | `memory_followup` | æœ‰æœ€è¿‘æœªè·Ÿè¿›çš„è®°å¿† | "ä¸Šæ¬¡ä½ æåˆ°æœ‰äº›ç„¦è™‘ï¼Œç°åœ¨å¥½ç‚¹äº†å—ï¼Ÿ" |
| 3 | `streak_celebrate` | è¿ç»­å®Œæˆ >= 3 å¤© | "æœ€è¿‘çŠ¶æ€ä¸é”™å•Šï¼è¿ç»­ 5 å¤©éƒ½å®Œæˆäº†ï¼" |
| 4 | `general_checkin` | æ— ç‰¹æ®Šæƒ…å†µ | "å˜¿ï¼Œä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæƒ³èŠçš„å—ï¼Ÿ" |

### 2.3 è®°å¿†ä¿å­˜æµç¨‹

å¯¹è¯ç»“æŸæ—¶ï¼Œè‡ªåŠ¨æå–å¹¶ä¿å­˜ç”¨æˆ·çš„å…³é”®ä¿¡æ¯ï¼š

```
ç”¨æˆ·ç‚¹å‡»"é€€å‡º"æŒ‰é’®
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥æ˜¯å¦ä¸ºæ—¥å¸¸å¯¹è¯ && æœ‰æ¶ˆæ¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Yes
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /memory-extractor              â”‚
â”‚ {                                   â”‚
â”‚   action: 'extract',                â”‚
â”‚   userId,                           â”‚
â”‚   messages: [å¯¹è¯å†å²],             â”‚
â”‚   taskDescription: 'æ—¥å¸¸å¯¹è¯',      â”‚
â”‚   localDate: '2026-02-03'           â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI åˆ†æå¯¹è¯ï¼Œæå–è®°å¿†ï¼š             â”‚
â”‚                                     â”‚
â”‚ - PROC: æ‹–å»¶åŸå›                     â”‚
â”‚   "ç”¨æˆ·å› ä¸ºåŠ ç­å¤ªç´¯æ²¡è¿åŠ¨"          â”‚
â”‚                                     â”‚
â”‚ - EMO: æƒ…ç»ª                         â”‚
â”‚   "ç”¨æˆ·æ„Ÿåˆ°ç„¦è™‘"                    â”‚
â”‚                                     â”‚
â”‚ - CONSEQUENCE: åæœ                 â”‚
â”‚   "ä¸è¿åŠ¨ç¬¬äºŒå¤©æ›´ç´¯"                â”‚
â”‚                                     â”‚
â”‚ - CONTEXT: ç”Ÿæ´»èƒŒæ™¯                 â”‚
â”‚   "ç”¨æˆ·æœ€è¿‘åœ¨èµ¶é¡¹ç›®"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å­˜åˆ° user_memories è¡¨             â”‚
â”‚ ï¼ˆè‡ªåŠ¨å»é‡ã€åˆå¹¶ç›¸ä¼¼è®°å¿†ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹æ¬¡å¯¹è¯/æ‰“ç”µè¯æ—¶å¯ä»¥è°ƒç”¨è¿™äº›è®°å¿†   â”‚
â”‚                                     â”‚
â”‚ AI: "ä¸Šæ¬¡ä½ è¯´åŠ ç­å¤ªç´¯æ²¡è¿åŠ¨ï¼Œ       â”‚
â”‚      æœ€è¿‘å·¥ä½œå‹åŠ›è¿˜å¤§å—ï¼Ÿ"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 å®Œæ•´è°ƒç”¨æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"ğŸ’¬ æ—¥å¸¸å¯¹è¯"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. fetchGeminiToken()               â”‚
â”‚    è·å– Gemini API Token            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. POST /get-daily-chat-context     â”‚
â”‚    - æŸ¥è¯¢ 7 å¤©å†…è·³è¿‡çš„ä»»åŠ¡           â”‚
â”‚    - æŸ¥è¯¢ç›¸å…³è®°å¿† (EMO, PROC...)    â”‚
â”‚    - è®¡ç®—è¿ç»­å®Œæˆå¤©æ•°                â”‚
â”‚    - é€‰æ‹©å¼€åœºç™½ç­–ç•¥                  â”‚
â”‚    - ç”Ÿæˆ suggestedOpening          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. POST /start-voice-chat           â”‚
â”‚    - chatType: 'daily_chat'         â”‚
â”‚    - context: { openingStrategy,    â”‚
â”‚        suggestedOpening,            â”‚
â”‚        skippedTask,                 â”‚
â”‚        relevantMemory,              â”‚
â”‚        completedStreak }            â”‚
â”‚    - ç”Ÿæˆå®Œæ•´ System Prompt         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. geminiLive.connect()             â”‚
â”‚    - è¿æ¥ Gemini Live API           â”‚
â”‚    - ä¼ å…¥ systemPrompt              â”‚
â”‚    - ä¼ å…¥ voiceName: 'Aoede'        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. AI ä½¿ç”¨å¼€åœºç™½å¼€å£                 â”‚
â”‚    "æ˜¨å¤©é‚£ä¸ªã€è·‘æ­¥ã€å¥½åƒæ²¡åšæˆï¼Ÿ"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å®æ—¶å¯¹è¯ + æ„å›¾æ£€æµ‹              â”‚
â”‚    - ç”¨æˆ·è¯´è¯ â†” AI å›å¤             â”‚
â”‚    - AI åœæ­¢è¯´è¯ â†’ è§¦å‘æ„å›¾æ£€æµ‹     â”‚
â”‚    - æ£€æµ‹åˆ°å·¥å…·éœ€æ±‚ â†’ è™šæ‹Ÿæ¶ˆæ¯æ³¨å…¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. å®ç°è®°å½•

### 2026-02-03
- å®Œæˆå‰åç«¯ä»£ç å®ç°
- å‰ç«¯ï¼š`VoiceChatTest.tsx` é›†æˆæ—¥å¸¸å¯¹è¯æ¨¡å¼
- åç«¯ï¼š`get-daily-chat-context` å’Œ `start-voice-chat` Edge Functions
- **æ–°å¢**ï¼šå¯¹è¯ç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨ `memory-extractor` ä¿å­˜è®°å¿†
- å¾…æµ‹è¯•ï¼šå®Œæ•´æµç¨‹è”è°ƒ

---

## 4. å…³é”®æ–‡ä»¶

### å‰ç«¯

| æ–‡ä»¶ | ä½œç”¨ |
|------|-----|
| `src/pages/DevTestPage.tsx` | /dev æµ‹è¯•é¢æ¿å…¥å£ |
| `src/components/dev/VoiceChatTest.tsx` | æ—¥å¸¸å¯¹è¯æ ¸å¿ƒç»„ä»¶ï¼ˆ484 è¡Œï¼‰ |
| `src/hooks/gemini-live/useGeminiLive.ts` | Gemini Live API å°è£… |
| `src/hooks/ai-tools/useIntentDetection.ts` | æ„å›¾æ£€æµ‹ Hookï¼ˆç¬¬äºŒå±‚ AIï¼‰ |

### åç«¯ (Lumi-supabase)

| æ–‡ä»¶ | ç«¯ç‚¹ | ä½œç”¨ |
|------|------|-----|
| `supabase/functions/get-daily-chat-context/index.ts` | `POST /functions/v1/get-daily-chat-context` | è·å–æ—¥å¸¸å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆ367 è¡Œï¼‰ |
| `supabase/functions/start-voice-chat/index.ts` | `POST /functions/v1/start-voice-chat` | ç”Ÿæˆç³»ç»Ÿæç¤ºè¯ï¼ˆ509 è¡Œï¼‰ |
| `supabase/functions/memory-extractor/index.ts` | `POST /functions/v1/memory-extractor` | æå–å¹¶ä¿å­˜å¯¹è¯è®°å¿†ï¼ˆ1274 è¡Œï¼‰ |

### æ•°æ®åº“è¡¨

| è¡¨å | ç”¨é€” |
|------|-----|
| `tasks` | æŸ¥è¯¢è¢«è·³è¿‡çš„ä»»åŠ¡ |
| `user_memories` | æŸ¥è¯¢ç”¨æˆ·è®°å¿†ï¼ˆEMO, PROC, CONTEXT, CONSEQUENCEï¼‰ |
| `chat_sessions` | è®°å½•å¯¹è¯ä¼šè¯ |

---

## 5. å¾…åŠäº‹é¡¹

### æµ‹è¯•éªŒè¯
- [ ] å¯åŠ¨æœ¬åœ° Supabase æœåŠ¡
- [ ] å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
- [ ] æµ‹è¯•å®Œæ•´å¯¹è¯æµç¨‹
- [ ] éªŒè¯å¼€åœºç™½ç­–ç•¥æ˜¯å¦æ­£ç¡®é€‰æ‹©
- [ ] éªŒè¯æ„å›¾æ£€æµ‹æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] éªŒè¯è®°å¿†ä¿å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ

### åŠŸèƒ½å®Œå–„
- [ ] æ·»åŠ çœŸå®ç”¨æˆ· ID æ”¯æŒï¼ˆç›®å‰ç¡¬ç¼–ç æµ‹è¯• IDï¼‰
- [x] ~~æ·»åŠ å¯¹è¯ç»“æŸåçš„è®°å¿†ä¿å­˜~~ âœ… å·²å®Œæˆ
- [ ] æ·»åŠ å¯¹è¯å†å²è®°å½•æŸ¥çœ‹

### æ–‡æ¡£
- [ ] æ›´æ–°æ¶æ„æ–‡æ¡£
- [ ] å®Œæˆåè¿ç§»åˆ° `implementation-log/`

---

## 6. API è¯¦æƒ…

### GET /functions/v1/get-daily-chat-context

**è¯·æ±‚ä½“**ï¼š
```json
{
  "userId": "uuid"
}
```

**å“åº”ä½“**ï¼š
```json
{
  "success": true,
  "openingStrategy": "task_skip",
  "suggestedOpening": "æ˜¨å¤©é‚£ä¸ªã€è·‘æ­¥ã€å¥½åƒæ²¡åšæˆï¼Ÿå‘ç”Ÿä»€ä¹ˆäº†å—ï½",
  "context": {
    "skippedTask": { "id": "uuid", "text": "è·‘æ­¥", "skippedAt": "2026-02-02" },
    "relevantMemory": { "content": "æœ€è¿‘å·¥ä½œå‹åŠ›å¤§", "tag": "CONTEXT" },
    "completedStreak": 5
  }
}
```

### POST /functions/v1/start-voice-chat

**è¯·æ±‚ä½“**ï¼š
```json
{
  "userId": "uuid",
  "chatType": "daily_chat",
  "context": {
    "openingStrategy": "task_skip",
    "suggestedOpening": "æ˜¨å¤©é‚£ä¸ªã€è·‘æ­¥ã€å¥½åƒæ²¡åšæˆï¼Ÿ",
    "skippedTask": { "id": "uuid", "text": "è·‘æ­¥", "skippedAt": "2026-02-02" },
    "relevantMemory": { "content": "...", "tag": "EMO" },
    "completedStreak": 5
  },
  "aiTone": "gentle"
}
```

**å“åº”ä½“**ï¼š
```json
{
  "success": true,
  "sessionId": "uuid",
  "geminiConfig": {
    "apiKey": "...",
    "model": "gemini-2.0-flash-exp",
    "systemPrompt": "...(å®Œæ•´ç³»ç»Ÿæç¤ºè¯)...",
    "voiceConfig": { "voiceName": "Aoede" }
  },
  "availableTools": ["get_daily_report", "suggest_habit_stack"]
}
```

### POST /functions/v1/memory-extractor

**è¯·æ±‚ä½“**ï¼š
```json
{
  "action": "extract",
  "userId": "uuid",
  "messages": [
    { "role": "user", "content": "æ˜¨å¤©æ²¡è·‘æ­¥æ˜¯å› ä¸ºåŠ ç­å¤ªç´¯äº†" },
    { "role": "assistant", "content": "æˆ‘ç†è§£ï¼Œå·¥ä½œå‹åŠ›å¤§ç¡®å®ä¼šå½±å“è¿åŠ¨çš„åŠ¨åŠ›..." }
  ],
  "taskDescription": "æ—¥å¸¸å¯¹è¯",
  "localDate": "2026-02-03",
  "metadata": {
    "source": "daily_chat",
    "timestamp": "2026-02-03T10:30:00Z"
  }
}
```

**å“åº”ä½“**ï¼š
```json
{
  "extracted": 3,
  "saved": 2,
  "merged": 1,
  "results": [
    { "action": "created", "memoryId": "uuid", "content": "..." },
    { "action": "merged", "memoryId": "uuid", "content": "...", "mergedFrom": ["uuid1", "uuid2"] }
  ],
  "memories": [
    { "content": "ç”¨æˆ·å› ä¸ºåŠ ç­å¤ªç´¯æ²¡è¿åŠ¨", "tag": "PROC", "confidence": 0.8 },
    { "content": "ç”¨æˆ·æ„Ÿåˆ°ç„¦è™‘", "tag": "EMO", "confidence": 0.7 },
    { "content": "ç”¨æˆ·æœ€è¿‘åœ¨èµ¶é¡¹ç›®deadline", "tag": "CONTEXT", "confidence": 0.75 }
  ]
}
```

**è®°å¿†æ ‡ç­¾ç±»å‹**ï¼š

| æ ‡ç­¾ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| PROC | æ‹–å»¶åŸå›  | "ç”¨æˆ·å› ä¸ºåŠ ç­å¤ªç´¯æ²¡è¿åŠ¨" |
| EMO | æƒ…ç»ª | "ç”¨æˆ·æ„Ÿåˆ°ç„¦è™‘" |
| CONSEQUENCE | åæœ | "ä¸è¿åŠ¨ç¬¬äºŒå¤©æ›´ç´¯" |
| CONTEXT | ç”Ÿæ´»èƒŒæ™¯ | "ç”¨æˆ·æœ€è¿‘åœ¨èµ¶é¡¹ç›®" |
| PREF | AI äº¤äº’åå¥½ | "ç”¨æˆ·ä¸å–œæ¬¢è¢«å‚¬ä¿ƒ" |
| EFFECTIVE | æœ‰æ•ˆæ¿€åŠ±æ–¹å¼ | "å€’æ•° 3-2-1 å¯¹ç”¨æˆ·æœ‰æ•ˆ" |

---

## 7. ç›¸å…³ commit

ï¼ˆå¾…æ·»åŠ ï¼‰
